!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../smarty/smarty")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../smarty/smarty"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("smartymixed",function(t){var l,i,a,r,n=e.getMode(t,"htmlmixed"),o=e.getMode(t,"smarty"),l={rightDelimiter:"}",leftDelimiter:"{"};return t.hasOwnProperty("leftDelimiter")&&(l.leftDelimiter=t.leftDelimiter),t.hasOwnProperty("rightDelimiter")&&(l.rightDelimiter=t.rightDelimiter),i={smartyComment:new RegExp("^"+l.leftDelimiter+"\\*"),literalOpen:new RegExp(l.leftDelimiter+"literal"+l.rightDelimiter),literalClose:new RegExp(l.leftDelimiter+"/literal"+l.rightDelimiter),hasLeftDelimeter:new RegExp(".*"+l.leftDelimiter),htmlHasLeftDelimeter:new RegExp("[^<>]*"+l.leftDelimiter)},a={chain:function(e,t,l){return t.tokenize=l,l(e,t)},cleanChain:function(e,t,l){return t.tokenize=null,t.localState=null,t.localMode=null,"string"==typeof l?l?l:null:l(e,t)},maybeBackup:function(e,t,l){var i,a=e.current(),r=a.search(t);return r>-1?e.backUp(a.length-r):(i=a.match(/<\/?$/))&&(e.backUp(a.length),e.match(t,!1)||e.match(a[0])),l}},r={html:function(e,t){return!t.inLiteral&&e.match(i.htmlHasLeftDelimeter,!1)&&null===t.htmlMixedState.htmlState.tagName?(t.tokenize=r.smarty,t.localMode=o,t.localState=o.startState(n.indent(t.htmlMixedState,"")),a.maybeBackup(e,l.leftDelimiter,o.token(e,t.localState))):!t.inLiteral&&e.match(l.leftDelimiter,!1)?(t.tokenize=r.smarty,t.localMode=o,t.localState=o.startState(n.indent(t.htmlMixedState,"")),a.maybeBackup(e,l.leftDelimiter,o.token(e,t.localState))):n.token(e,t.htmlMixedState)},smarty:function(e,t){if(e.match(l.leftDelimiter,!1)){if(e.match(i.smartyComment,!1))return a.chain(e,t,r.inBlock("comment","*"+l.rightDelimiter))}else if(e.match(l.rightDelimiter,!1))return e.eat(l.rightDelimiter),t.tokenize=r.html,t.localMode=n,t.localState=t.htmlMixedState,"tag";return a.maybeBackup(e,l.rightDelimiter,o.token(e,t.localState))},inBlock:function(e,t){return function(l,i){for(;!l.eol();){if(l.match(t)){a.cleanChain(l,i,"");break}l.next()}return e}}},{startState:function(){var e=n.startState();return{token:r.html,localMode:null,localState:null,htmlMixedState:e,tokenize:null,inLiteral:!1}},copyState:function(t){var l=null,i=t.tokenize||t.token;return t.localState&&(l=e.copyState(i!=r.html?o:n,t.localState)),{token:t.token,tokenize:t.tokenize,localMode:t.localMode,localState:l,htmlMixedState:e.copyState(n,t.htmlMixedState),inLiteral:t.inLiteral}},token:function(e,t){if(e.match(l.leftDelimiter,!1)){if(!t.inLiteral&&e.match(i.literalOpen,!0))return t.inLiteral=!0,"keyword";if(t.inLiteral&&e.match(i.literalClose,!0))return t.inLiteral=!1,"keyword"}t.inLiteral&&t.localState!=t.htmlMixedState&&(t.tokenize=r.html,t.localMode=n,t.localState=t.htmlMixedState);var a=(t.tokenize||t.token)(e,t);return a},indent:function(t,l){return t.localMode==o||t.inLiteral&&!t.localMode||i.hasLeftDelimeter.test(l)?e.Pass:n.indent(t.htmlMixedState,l)},innerMode:function(e){return{state:e.localState||e.htmlMixedState,mode:e.localMode||n}}}},"htmlmixed","smarty"),e.defineMIME("text/x-smarty","smartymixed")});