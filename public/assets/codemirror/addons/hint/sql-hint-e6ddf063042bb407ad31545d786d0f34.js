!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}(function(t){"use strict";function e(e){var r=e.doc.modeOption;return"sql"===r&&(r="text/x-sql"),t.resolveMode(r).keywords}function r(t,e){var r=t.length,n=e.substr(0,r);return t.toUpperCase()===n.toUpperCase()}function n(t,e,n,o){for(var i in n)n.hasOwnProperty(i)&&(Array.isArray(n)&&(i=n[i]),r(e,i)&&t.push(o(i)))}function o(t,e){var r=e.getCursor(),o=e.getTokenAt(r),i=o.string.substr(1),s=g(r.line,o.start),a=e.getTokenAt(s).string;l.hasOwnProperty(a)||(a=u(a,e));var f=l[a];f&&n(t,i,f,function(t){return"."+t})}function i(t,e){if(t)for(var r=/[,;]/g,n=t.split(" "),o=0;o<n.length;o++)e(n[o]?n[o].replace(r,""):"")}function s(t){return t.line+t.ch/Math.pow(10,6)}function a(t){return g(Math.floor(t),+t.toString().split(".").pop())}function u(t,e){for(var r=e.doc,n=r.getValue(),o=t.toUpperCase(),u="",f="",p=[],d={start:g(0,0),end:g(e.lastLine(),e.getLineHandle(e.lastLine()).length)},h=n.indexOf(c.QUERY_DIV);-1!=h;)p.push(r.posFromIndex(h)),h=n.indexOf(c.QUERY_DIV,h+1);p.unshift(g(0,0)),p.push(g(e.lastLine(),e.getLineHandle(e.lastLine()).text.length));for(var v=0,A=s(e.getCursor()),m=0;m<p.length;m++){var b=s(p[m]);if(A>v&&b>=A){d={start:a(v),end:a(b)};break}v=b}for(var q=r.getRange(d.start,d.end,!1),m=0;m<q.length;m++){var y=q[m];if(i(y,function(t){var e=t.toUpperCase();e===o&&l.hasOwnProperty(u)&&(f=u),e!==c.ALIAS_KEYWORD&&(u=t)}),f)break}return f}function f(t,r){l=r&&r.tables||{},p=p||e(t);var i=t.getCursor(),s=t.getTokenAt(i),a=s.end,u=[],f=s.string.trim();if("."==f.charAt(0)){if(o(u,t),!u.length){for(;s.start&&"."==f.charAt(0);)s=t.getTokenAt(g(i.line,s.start-1)),f=s.string+f;n(u,f,l,function(t){return t})}}else n(u,f,p,function(t){return t.toUpperCase()}),n(u,f,l,function(t){return t});return{list:u,from:g(i.line,s.start),to:g(i.line,a)}}var l,p,c={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},g=t.Pos;t.registerHelper("hint","sql",f)});